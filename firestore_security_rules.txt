Firestore Security Rules for Baby Routine Tracker
================================================

IMPORTANT: These rules need to be applied in the Firebase Console under Firestore Database > Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection - users can only access their own document
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Babies collection - users can only access babies where their userId is in parentIds array
    match /babies/{babyId} {
      // Allow read if user is a parent
      allow read: if request.auth != null && 
                     request.auth.uid in resource.data.parentIds;
      
      allow create: if request.auth != null && 
                       request.auth.uid in request.resource.data.parentIds;
      
      // Allow update if user is current parent OR will become a parent (invitation acceptance)
      allow update: if request.auth != null && 
                       (request.auth.uid in resource.data.parentIds ||
                        request.auth.uid in request.resource.data.parentIds);
      
      allow delete: if request.auth != null && 
                       request.auth.uid in resource.data.parentIds;
    }
    
    // Invitations collection - special rules for invitation system
    match /invitations/{invitationId} {
      // Anyone authenticated can read invitations by invitation code (for joining)
      allow read: if request.auth != null;
      
      // Only the inviting user can create invitations
      allow create: if request.auth != null && 
                       request.auth.uid == request.resource.data.invitedBy;
      
      // Only the inviting user and the system can update invitations
      // (accepting invitation updates status)
      allow update: if request.auth != null;
      
      // Only the inviting user can delete invitations
      allow delete: if request.auth != null && 
                       request.auth.uid == resource.data.invitedBy;
    }
    
    // Activity logs (for future implementation) - only parents can access
    match /babies/{babyId}/activities/{activityId} {
      allow read, write: if request.auth != null && 
                            request.auth.uid in get(/databases/$(database)/documents/babies/$(babyId)).data.parentIds;
    }
    
    // Sleep plans (for future implementation) - only parents can access
    match /babies/{babyId}/sleepPlans/{planId} {
      allow read, write: if request.auth != null && 
                            request.auth.uid in get(/databases/$(database)/documents/babies/$(babyId)).data.parentIds;
    }
  }
}

Instructions for applying these rules:
=====================================
1. Open Firebase Console (https://console.firebase.google.com/)
2. Navigate to your Baby Routine Tracker project
3. Go to Firestore Database
4. Click on "Rules" tab
5. Replace the existing rules with the rules above
6. Click "Publish" to apply the changes

Security Features:
==================
- Users can only access their own user document
- Users can only access baby profiles where they are listed as parents
- Invitations are publicly readable by invitation code but only writable by the inviting user
- Activity logs and sleep plans are only accessible by baby's parents
- All operations require authentication

Note: These rules ensure data privacy and security while allowing the invitation
system to work properly for sharing baby profiles between partners.
